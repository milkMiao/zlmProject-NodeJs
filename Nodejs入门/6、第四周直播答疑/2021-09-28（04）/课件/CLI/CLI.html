<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="css/prism.min.css"/><link rel="stylesheet" type="text/css" href="css/katex.min.css"/><link rel="stylesheet" type="text/css" href="css/wolai.css"/><title>CLI - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="CLI" class="main-title"></div></div></header><article><h1 class="wolai-block inline-wrap"><span>大纲</span></h1><ul class="wolai-block"><li class="inline-wrap"><div class="marker"></div><span>CLI 在前端开发中的应用场景</span></li><li class="inline-wrap"><div class="marker"></div><span>使用 Node.js 构建 CLI 工具（基于<span class="jill"></span>CLI 的 Web<span class="jill"></span>应用构建工具）</span></li><li class="inline-wrap"><div class="marker"></div><span>使用命令行参数实现子命令与选项功能</span><ul class="wolai-block"><li class="inline-wrap"><div class="marker"></div><span>使用内置对象获取命令行参数</span></li><li class="inline-wrap"><div class="marker"></div><span>使用 minimist 获取命令行参数</span></li></ul></li><li class="inline-wrap"><div class="marker"></div><span>使用 enquirer 实现交互式 CLI</span></li><li class="inline-wrap"><div class="marker"></div><span>CLI 美颜工具 chalk</span></li><li class="inline-wrap"><div class="marker"></div><span>使用 npm 发布 CLI 工具包</span><ul class="wolai-block"><li class="inline-wrap"><div class="marker"></div><span>使用 npm 注册、发布、更新、移除 CLI 工具包</span></li><li class="inline-wrap"><div class="marker"></div><span>二进制可执行文件的使用</span></li><li class="inline-wrap"><div class="marker"></div><span>bin<span class="jill"></span>字段的意义</span></li><li class="inline-wrap"><div class="marker"></div><span>全局安装</span></li></ul></li></ul><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h1 class="wolai-block inline-wrap"><span>收获</span></h1><div class="wolai-block wolai-text"><div class="inline-wrap"><span>现代前端开发除了日常编码外，还会使用到各种工具去辅助更快更好的完成工作，譬如：webpack、babel、eslist、jest、git<span class="jill"></span>等等……，而这些工具又大多是以 CLI 的形式出现的。</span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>通过这节课的学习，我们不但会了解到什么是 CLI 及其使用，同时还会深入到原理去了解这类程序的实现。</span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>结合工作实际需求和场景去编写实现满足自己业务的各种 CLI 工具，也是现在前端开发工程师不可或缺的一项技能了。</span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h1 class="wolai-block inline-wrap"><span>What: 什么是 CLI ？</span></h1><blockquote class="wolai-block inline-wrap"><span><strong>命令行界面</strong></span><span>（英语：</span><span><strong>C</strong></span><span>ommand-</span><span><strong>L</strong></span><span>ine </span><span><strong>I</strong></span><span>nterface，缩写：</span><span><strong>CLI</strong></span><span>）是在</span><span><a href="https://zh.wikipedia.org/wiki/图形用户界面"><span>图形用户界面</span></a></span><span>得到普及之前使用最为广泛的</span><span><a href="https://zh.wikipedia.org/wiki/用户界面"><span>用户界面</span></a></span><span>，它通常不支持</span><span><a href="https://zh.wikipedia.org/wiki/鼠标"><span>鼠标</span></a></span><span>，用户通过</span><span><a href="https://zh.wikipedia.org/wiki/键盘"><span>键盘</span></a></span><span>输入指令，计算机接收到指令后，予以执行。也有人称之为</span><span><strong>字符用户界面</strong></span><span>（character user interface, CUI）。

— 来自《</span><span><a href="https://zh.wikipedia.org/wiki/%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%95%8C%E9%9D%A2"><span>维基百科</span></a></span><span>》</span></blockquote><div class="wolai-block wolai-text"><div class="inline-wrap"><span>不同操作系统下都提供了运行 CLI 的应用程序：</span></div></div><ul class="wolai-block"><li class="inline-wrap"><div class="marker"></div><span>Windows：CMD、PowerShell……</span></li><li class="inline-wrap"><div class="marker"></div><span>Linux：bash……</span></li><li class="inline-wrap"><div class="marker"></div><span>Mac：Terminal、iTerm……</span></li></ul><div class="wolai-block wolai-center"><figure><img src="media/image.png" alt="mac下的 iTerm" style="width: 1396px"/><figcaption>mac下的 iTerm</figcaption></figure></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>与 CLI 对应的还有 GUI 程序</span></div></div><blockquote class="wolai-block inline-wrap"><span><strong>图形用户界面</strong></span><span>（英语：</span><span><strong>G</strong></span><span>raphical </span><span><strong>U</strong></span><span>ser </span><span><strong>I</strong></span><span>nterface，缩写：</span><span><strong>GUI</strong></span><span>）是指采用图形方式显示的</span><span><a href="https://zh.wikipedia.org/wiki/计算机"><span>计算机</span></a></span><span>操作</span><span><a href="https://zh.wikipedia.org/wiki/用户界面"><span>用户界面</span></a></span><span>。与早期计算机使用的</span><span><a href="https://zh.wikipedia.org/wiki/命令行界面"><span>命令行界面</span></a></span><span>相比，除了降低用户的操作负担之外，对于新用户而言，图形界面对于用户来说在</span><span><a href="https://zh.wikipedia.org/wiki/视觉"><span>视觉</span></a></span><span>上更易于接受，学习成本大幅下降，也让电脑的大众化得以实现。

— 来自《</span><span><a href="https://zh.wikipedia.org/wiki/%E5%9B%BE%E5%BD%A2%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2"><span>维基百科</span></a></span><span>》</span></blockquote><div class="wolai-block wolai-text"><div class="inline-wrap"><span>我们日常使用的 浏览器、vscode、QQ 都是基于 GUI 的应用。</span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h1 class="wolai-block inline-wrap"><span>Why: 为什么要使用 CLI ？</span></h1><ul class="wolai-block"><li class="inline-wrap"><div class="marker"></div><span>资源相对（GUI）占用少。</span></li><li class="inline-wrap"><div class="marker"></div><span>启动更迅速。</span></li><li class="inline-wrap"><div class="marker"></div><span>跨平台、移植性、融合性更好。</span></li></ul><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h1 class="wolai-block inline-wrap"><span>How: 如何构建 CLI 程序 ？</span></h1><div class="wolai-block wolai-text"><div class="inline-wrap"><span>我们可以使用各种不同的语言去构建一个 CLI 应用程序，如：Python、Java、C、C++、Node.js……</span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h1 class="wolai-block inline-wrap"><span>使用 Node.js 构建 CLI 程序</span></h1><div class="wolai-block wolai-text"><div class="inline-wrap"><span>实际上我们在我们安装 Node.js 的时候就安装了一个基于 CLI 的执行程序，使用这个 CLI 程序可以帮助我们执行 Node.js 脚本：</span></div></div><div class="wolai-block wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre><span class="token operator">></span> node a<span class="token punctuation">.</span><span class="token property-access">js</span>
</pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>看到这里，大家应该就明白了，我们一直写的 Node.js 代码，其实就是运行在 CLI 下的一个程序。</span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>在正式编写一个 CLI 程序之前，我们先来了解一下<span class="jill"></span>CLI 程序中涉及到的一些（通用）概念：</span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>命令</strong></span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>通常我们执行的 CLI 程序本身就是一个命令（主命令），当 CLI 程序功能分类比较多的时候，我们还可以根据子功能的不同提供更多的一些子命令，如：</span></div></div><div class="wolai-block wolai-pre"><div data-lang="Bash" class="marker"></div><pre>// create 子命令
vue create <span class="token operator">&lt;</span>project-name<span class="token operator">></span>

// <span class="token function">add</span> 
vue <span class="token function">add</span> <span class="token operator">&lt;</span>plugin-name<span class="token operator">></span></pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>选项</strong></span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>选项是命令内置好的一些选项，以供调用命令的时候根据不同的需要进项选配：</span></div></div><div class="wolai-block wolai-pre"><div data-lang="Bash" class="marker"></div><pre>// -f 或 --force 选项（当app1已存在的时候，-f 强制重新创建并覆盖）
vue create app1 -f
</pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>参数</strong></span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>参数是配合着命令调用传入的数据，类似函数参数的概念，如上 &lt;project-name&gt; 和 &lt;plugin-name&gt; 就是参数：</span></div></div><div class="wolai-block wolai-pre"><div data-lang="Bash" class="marker"></div><pre>vue create app1</pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h1 class="wolai-block inline-wrap"><span>案例</span></h1><div class="wolai-block wolai-text"><div class="inline-wrap"><span>结合我们学习过的基于 Koa 的 WebServer 应用的构建，来创建一个用 CLI 来构建、依赖安装、应用初始化等功能的 CLI 工具。</span></div></div><div class="wolai-block wolai-center"><figure><img src="media/Untitled.gif" style="width: 1279px"/></figure></div><h2 class="wolai-block inline-wrap"><span>功能</span></h2><div class="wolai-block wolai-pre"><div data-lang="Bash" class="marker"></div><pre>// 帮助
$ create-web-server -h
Usage: create-web-server <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>web-server-name<span class="token punctuation">]</span>

Arguments:
  web-server-name   web server 应用名称，英文、数字、_、-组成

Options:
  -V, --version     output the version number
  -f --force        当项目已存在当时，候强制创建项目
  -p --port <span class="token operator">&lt;</span>port<span class="token operator">></span>  项目端口 <span class="token punctuation">(</span>default: <span class="token string">"8888"</span><span class="token punctuation">)</span>
  -r --run          初始化完成以后自动启动服务
  -o --open         启动完成以后自动打开浏览器
  -h, --help        display <span class="token builtin class-name">help</span> <span class="token keyword">for</span> <span class="token builtin class-name">command</span>
  
// 打印版本
$ create-web-server -V
<span class="token number">1.0</span>.0
  
// 使用
$ create-web-server app
? 请输入应用名称 <span class="token punctuation">(</span>app<span class="token punctuation">)</span>
? 请输入应用端口 <span class="token number">8888</span>
? 请选择要安装的中间件 <span class="token punctuation">(</span>Press <span class="token operator">&lt;</span>space<span class="token operator">></span> to select, <span class="token operator">&lt;</span>a<span class="token operator">></span> to toggle all, <span class="token operator">&lt;</span>i<span class="token operator">></span> to invert selection<span class="token punctuation">)</span>
❯◉ koa-static-cache
 ◉ koa-router
 ◯ koa-body
? 安装完成后是否自动启动服务 <span class="token punctuation">(</span>Y/n<span class="token punctuation">)</span>
? 服务启动完成后是否自动打开浏览器 <span class="token punctuation">(</span>Y/n<span class="token punctuation">)</span>
<span class="token punctuation">..</span>.</pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h1 class="wolai-block inline-wrap"><span>bin 文件</span></h1><div class="wolai-block wolai-text"><div class="inline-wrap"><span>通常，我们的 node.js 文件需要使用 node 这个 CLI 命令来运行，如：</span></div></div><div class="wolai-block wolai-pre"><div data-lang="Bash" class="marker"></div><pre>node test.js</pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>我们可以使用如下的方式来简化脚本运行</span></div></div><div class="wolai-block wolai-pre"><div data-lang="Javascript" class="marker"></div><pre><span class="token hashbang comment">#!/usr/bin/env node</span>
<span class="token comment">// 注：#! 行 必须写在第一行，指定该脚本解析器路径</span>
<span class="token comment">// /usr/bin/env => env: 获取环境变量信息</span>
<span class="token comment">// /usr/bin/env node => env | grep PATH => 从环境变量 PATH 中查找 node 并执行</span>
<span class="token comment">// 使用 env 查找 node，比直接指定 node 路径要好，因为不是所有人的 node 安装路径都是同一个</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>这样，我们就可以命令行中省略 node 了</span></div></div><div class="wolai-block wolai-pre"><div data-lang="Bash" class="marker"></div><pre>./test.js</pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>// 注意这里的 ./ ，当前需要使用相对路径，在最后，我们把它做成全局使用的，就可以任意位置直接使用 test.js（.js<span class="jill"></span>也可省略）。</span></div></div><blockquote class="wolai-block inline-wrap"><span>注意权限问题（Mac、Liunx）：chmod 更改文件执行权限</span></blockquote><div class="wolai-block wolai-center"><figure><img src="media/image_1.png" style="width: 1287px"/></figure></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h1 class="wolai-block inline-wrap"><span>命令行参数数据的获取</span></h1><div class="wolai-block wolai-text"><div class="inline-wrap"><span>如前面所说，我们的命令支持一些参数和选项，如：</span><span><code>create-web-server -h</code></span><span> 中的 </span><span><code>-h</code></span><span>  。</span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>我们可以使用 Node.js 内置 </span><span><code>process</code></span><span> 对象的 </span><span><code>argv</code></span><span> 属性来获取这些数据：</span></div></div><div class="wolai-block wolai-pre"><div data-lang="Bash" class="marker"></div><pre>$ create-web-server -h</pre></div><div class="wolai-block wolai-pre"><div data-lang="Node.js" class="marker"></div><pre><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span> process<span class="token punctuation">.</span><span class="token property-access">argv</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// output</span>
<span class="token comment">// ['node的路径','当前执行文件的路径','参数、选项'...]</span></pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h1 class="wolai-block inline-wrap"><span>构建命令基础功能结构</span></h1><div class="wolai-block wolai-text"><div class="inline-wrap"><span>使用 node.js 内置的 process.argv 去处理参数和选项，在参数和选项比较多的情况下，会特别的繁琐，我们可以一些第三方的库来完成：</span></div></div><h2 class="wolai-block inline-wrap"><span>commander 库</span></h2><div class="wolai-block wolai-text"><div class="inline-wrap"><span>该库对 process.argv 进行解析，并提供了更易用的 API 来构建 CLI 子命令、参数、选项 等功能……</span></div></div><div class="wolai-row"><div class="wolai-col" style="flex-grow: 0.5"><div class="wolai-bookmark wolai-block"><a href="https://www.npmjs.com/package/commander">npm: commander</a><div class="info-box"><div class="text-pane"><div data-title="npm: commander"></div><div data-desc="the complete solution for node.js command-line programs"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://static.npmjs.com/1996fcfdf7ca81ea795f67f093d7f449.png&quot;)"></div><div data-hostname="www.npmjs.com"></div></div></div><div class="preview-pane" style="background-image: url(https://static.npmjs.com/338e4905a2684ca96e08c7780fc68412.png)"></div></div></div></div><div class="wolai-col" style="flex-grow: 0.5"><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>安装</strong></span></div></div><div class="wolai-block wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre>npm install commander</pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>Commander<span class="jill"></span>类</strong></span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>通过实例化 Commander 类对象来完成 CLI 程序构建。</span></div></div><div class="wolai-block wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token maybe-class-name">Command</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Command</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>或直接调用内置构建好的一个 实例对象：</span></div></div><div class="wolai-block wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre><span class="token keyword">const</span> <span class="token punctuation">{</span> program <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'commander'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>选项</strong></span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>通过 </span><span><code>option</code></span><span> 方法指定要解析的选项：</span></div></div><div class="wolai-block wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre>program<span class="token punctuation">.</span><span class="token method function property-access">option</span><span class="token punctuation">(</span><span class="token string">'-v, --version'</span><span class="token punctuation">,</span> <span class="token string">'这是参数的描述'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置选项参数</span>
program<span class="token punctuation">.</span><span class="token method function property-access">option</span><span class="token punctuation">(</span><span class="token string">'-p, --port'</span><span class="token punctuation">,</span> <span class="token string">'端口'</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>可选</strong></span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><code>&lt;&gt;</code></span><span> 表示必填。</span></div></div><div class="wolai-block wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre>program<span class="token punctuation">.</span><span class="token method function property-access">option</span><span class="token punctuation">(</span><span class="token string">'-p, --port &lt;port>'</span><span class="token punctuation">,</span> <span class="token string">'端口'</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>必填</strong></span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><code>[]</code></span><span> 表示可选</span></div></div><div class="wolai-block wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre>program<span class="token punctuation">.</span><span class="token method function property-access">option</span><span class="token punctuation">(</span><span class="token string">'-p, --port [port]'</span><span class="token punctuation">,</span> <span class="token string">'端口'</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>命令参数</strong></span></div></div><div class="wolai-block wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre>program<span class="token punctuation">.</span><span class="token method function property-access">argument</span><span class="token punctuation">(</span><span class="token string">'&lt;username>'</span><span class="token punctuation">,</span> <span class="token string">'登录用户名'</span><span class="token punctuation">,</span> <span class="token string">'默认值'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>处理函数</strong></span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>当命令解析后的执行函数</span></div></div><div class="wolai-block wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre>program<span class="token punctuation">.</span><span class="token method function property-access">action</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">参数<span class="token number">1</span>，参数<span class="token number">2</span><span class="token punctuation">,</span> 选项列表<span class="token punctuation">,</span> program</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>解析</strong></span></div></div><div class="wolai-block wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre>program<span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token property-access">argv</span><span class="token punctuation">)</span></pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h1 class="wolai-block inline-wrap"><span>命令行美化</span></h1><h2 class="wolai-block inline-wrap"><span>chalk 库</span></h2><div class="wolai-block wolai-text"><div class="inline-wrap"><span>对 CLI 程序的默认单调的字体进行一些美化，比如用醒目的颜色（如红色文字提示警告……）让使用者在一堆文字中一眼就能关注到重点信息。</span></div></div><div class="wolai-bookmark wolai-block"><a href="https://www.npmjs.com/package/chalk">npm: chalk</a><div class="info-box"><div class="text-pane"><div data-title="npm: chalk"></div><div data-desc="Terminal string styling done right"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://static.npmjs.com/1996fcfdf7ca81ea795f67f093d7f449.png&quot;)"></div><div data-hostname="www.npmjs.com"></div></div></div><div class="preview-pane" style="background-image: url(https://static.npmjs.com/338e4905a2684ca96e08c7780fc68412.png)"></div></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h1 class="wolai-block inline-wrap"><span>交互式命令行</span></h1><h2 class="wolai-block inline-wrap"><span>inquirer 库</span></h2><div class="wolai-block wolai-text"><div class="inline-wrap"><span>有的时候，我们需要 CLI 程序能够与用户进行一些交互，比如当某个 CLI 程序选项比较多，难以一一记忆，或者提供引导方式选择方式去使用，增强 CLI 程序的用户体验。</span></div></div><div class="wolai-bookmark wolai-block"><a href="https://www.npmjs.com/package/inquirer">npm: inquirer</a><div class="info-box"><div class="text-pane"><div data-title="npm: inquirer"></div><div data-desc="A collection of common interactive command line user interfaces."></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://static.npmjs.com/1996fcfdf7ca81ea795f67f093d7f449.png&quot;)"></div><div data-hostname="www.npmjs.com"></div></div></div><div class="preview-pane" style="background-image: url(https://static.npmjs.com/338e4905a2684ca96e08c7780fc68412.png)"></div></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>安装</strong></span></div></div><div class="wolai-block wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre>npm install inquirer</pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>创建交互式提问</strong></span><span>：</span></div></div><blockquote class="wolai-block inline-wrap"><span>inquirer.prompt(questions: Array&lt;Question&gt;, answers: ) -&gt; promise</span></blockquote><div class="wolai-block wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre><span class="token keyword">const</span> promptOptions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

promptOptions<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">"input"</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">"serverName"</span><span class="token punctuation">,</span>
  message<span class="token operator">:</span> <span class="token string">"请输入应用名称"</span><span class="token punctuation">,</span>
  <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token string">"app"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promptOptions<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">"input"</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">"serverPort"</span><span class="token punctuation">,</span>
  message<span class="token operator">:</span> <span class="token string">"请输入应用端口"</span><span class="token punctuation">,</span>
  <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token number">8888</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promptInitOptions<span class="token punctuation">.</span><span class="token property-access">serverPort</span> <span class="token operator">=</span> <span class="token number">9999</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> answer <span class="token operator">=</span> <span class="token keyword control-flow">await</span> inquirer<span class="token punctuation">.</span><span class="token method function property-access">prompt</span><span class="token punctuation">(</span>promptOptions<span class="token punctuation">,</span> promptInitOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>answer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></div><blockquote class="wolai-block inline-wrap"><span>Question 格式参考文档</span></blockquote><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h1 class="wolai-block inline-wrap"><span>执行 shell</span></h1><div class="wolai-block wolai-text"><div class="inline-wrap"><span>该库使用 Node.js 内置 process_child（子进程）执行 shell 命令。</span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>process_child</strong></span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>Node 可以通过 process_child 来创建进进程，实现多进程编程。</span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>process_child 提供了下面几种方式来新建子进程</span></div></div><ul class="wolai-block"><li class="inline-wrap"><div class="marker"></div><span><strong>spawn ： </strong></span><span>子进程中执行的是非<span class="jill"></span>node<span class="jill"></span>程序，提供一组参数后，执行的结果以流（Stream）的形式返回。</span></li><li class="inline-wrap"><div class="marker"></div><span><strong>exec：</strong></span><span>子进程执行的是非<span class="jill"></span>node<span class="jill"></span>程序，传入一串<span class="jill"></span>shell<span class="jill"></span>命令，执行后结果以回调的形式（Buffer）返回，与<span class="jill"></span>execFile<span class="jill"></span>不同的是<span class="jill"></span>exec<span class="jill"></span>可以直接执行一串<span class="jill"></span>shell<span class="jill"></span>命令。</span></li><li class="inline-wrap"><div class="marker"></div><span><strong>execFile：</strong></span><span>子进程中执行的是非<span class="jill"></span>node<span class="jill"></span>程序，提供一组参数后，执行的结果以回调的形式返回。</span></li><li class="inline-wrap"><div class="marker"></div><span><strong>fork：</strong></span><span>子进程执行的是<span class="jill"></span>node<span class="jill"></span>程序，提供一组参数后，执行的结果以流的形式返回，与<span class="jill"></span>spawn<span class="jill"></span>不同，fork<span class="jill"></span>生成的子进程只能执行<span class="jill"></span>node<span class="jill"></span>应用。接下来的小节将具体的介绍这一些方法。</span></li></ul><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>stdio</strong></span><span> 设置</span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>在创建子进程中提供了一个选项：stdio（标准输入输出流）的设置，用来设置父、子进程之前的通信方式，包含三个类型：stdin、stdout、stderr，参考：</span><span><a href="https://nodejs.org/dist/latest-v6.x/docs/api/child_process.html#child_process_child_process_spawn_command_args_options"><span>https://nodejs.org/dist/latest-v6.x/docs/api/child_process.html#child_process_child_process_spawn_command_args_options</span></a></span></div></div><ul class="wolai-block"><li class="inline-wrap"><div class="marker"></div><span><strong>pipe：</strong></span><span>相当于[&#39;pipe&#39;, &#39;pipe&#39;, &#39;pipe&#39;]，子进程的<span class="jill"></span>stdio<span class="jill"></span>和父进程的<span class="jill"></span>stdio<span class="jill"></span>通过管道进行连接。</span></li><li class="inline-wrap"><div class="marker"></div><span><strong>ignore：</strong></span><span>相当于[&#39;ignore&#39;,&#39;ignore&#39;, &#39;ignore&#39;]，子进程的<span class="jill"></span>stdio<span class="jill"></span>绑定到/dev/null,丢弃数据的输入输出。</span></li><li class="inline-wrap"><div class="marker"></div><span><strong>inherit：</strong></span><span>继承父进程相关的<span class="jill"></span>stdio,等同于[process.stdin,process.stdout,process.sterr]或者[0,1,2],此时子进程的<span class="jill"></span>stdio<span class="jill"></span>都是绑定在同一个地方。</span></li></ul><div class="wolai-bookmark wolai-block"><a href="https://www.npmjs.com/package/execa">npm: execa</a><div class="info-box"><div class="text-pane"><div data-title="npm: execa"></div><div data-desc="Process execution for humans"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://static.npmjs.com/1996fcfdf7ca81ea795f67f093d7f449.png&quot;)"></div><div data-hostname="www.npmjs.com"></div></div></div><div class="preview-pane" style="background-image: url(https://static.npmjs.com/338e4905a2684ca96e08c7780fc68412.png)"></div></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>安装：</strong></span></div></div><div class="wolai-block wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre>$ npm install execa</pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>commandSync</strong></span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>同步模式执行指定命令。</span></div></div><div class="wolai-block wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre><span class="token keyword">const</span> cmd <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm init -y</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
execa<span class="token punctuation">.</span><span class="token method function property-access">commandSync</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  cwd<span class="token operator">:</span> options<span class="token punctuation">.</span><span class="token property-access">rootDirectory</span><span class="token punctuation">,</span>
  stdio<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"inherit"</span><span class="token punctuation">,</span> <span class="token string">"inherit"</span><span class="token punctuation">,</span> <span class="token string">"inherit"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h1 class="wolai-block inline-wrap"><span>其它一些库</span></h1><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>package name 验证库</strong></span></div></div><div class="wolai-bookmark wolai-block"><a href="https://www.npmjs.com/package/validate-npm-package-name">npm: validate-npm-package-name</a><div class="info-box"><div class="text-pane"><div data-title="npm: validate-npm-package-name"></div><div data-desc="Give me a string and I&apos;ll tell you if it&apos;s a valid npm package name"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://static.npmjs.com/1996fcfdf7ca81ea795f67f093d7f449.png&quot;)"></div><div data-hostname="www.npmjs.com"></div></div></div><div class="preview-pane" style="background-image: url(https://static.npmjs.com/338e4905a2684ca96e08c7780fc68412.png)"></div></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>增强版的 fs 模块</strong></span></div></div><div class="wolai-bookmark wolai-block"><a href="https://www.npmjs.com/package/fs-extra">npm: fs-extra</a><div class="info-box"><div class="text-pane"><div data-title="npm: fs-extra"></div><div data-desc="fs-extra contains methods that aren&apos;t included in the vanilla Node.js fs package. Such as recursive mkdir, copy, and remove."></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://static.npmjs.com/1996fcfdf7ca81ea795f67f093d7f449.png&quot;)"></div><div data-hostname="www.npmjs.com"></div></div></div><div class="preview-pane" style="background-image: url(https://static.npmjs.com/338e4905a2684ca96e08c7780fc68412.png)"></div></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>开启<span class="jill"></span>URL、文件……</strong></span></div></div><div class="wolai-bookmark wolai-block"><a href="https://www.npmjs.com/package/open">npm: open</a><div class="info-box"><div class="text-pane"><div data-title="npm: open"></div><div data-desc="Open stuff like URLs, files, executables. Cross-platform."></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://static.npmjs.com/1996fcfdf7ca81ea795f67f093d7f449.png&quot;)"></div><div data-hostname="www.npmjs.com"></div></div></div><div class="preview-pane" style="background-image: url(https://static.npmjs.com/338e4905a2684ca96e08c7780fc68412.png)"></div></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h1 class="wolai-block inline-wrap"><span>在 NPM 上发布 package</span></h1><div class="wolai-block wolai-text"><div class="inline-wrap"><span>我们可以把本地的 package 发布到 npm 仓库让其他人使用，相关操作如下：</span></div></div><h2 class="wolai-block inline-wrap"><span>1、注册 npm 账户</span></h2><div class="wolai-block wolai-text"><div class="inline-wrap"><span>要把 package 发布到 npm 仓库中，首先需要拥有一个 npm 的账户，注册：</span><span><a href="https://www.npmjs.com/signup"><span>https://www.npmjs.com/signup</span></a></span><span> 。</span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h2 class="wolai-block inline-wrap"><span>2、管理维护 package</span></h2><div class="wolai-block wolai-text"><div class="inline-wrap"><span>有了 npm 账户以后，我们就可以把本地 package 通过 npm 提供了命令发布到 npm 仓库中，同时 npm 还提供了许多其它的命令来维护这些 package。</span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>在发布或更新等操作远程 npm 仓库之前，需要使用 npm login 登录授权</span></div></div><div class="wolai-block wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre>npm login
<span class="token operator">/</span><span class="token operator">/</span> 后续会提示输入用户名和密码</pre></div><h3 class="wolai-block inline-wrap"><span>2-1、发布</span></h3><div class="wolai-block wolai-text"><div class="inline-wrap"><span>进入 package 目录后，使用 npm publish 命令即可发布</span></div></div><div class="wolai-block wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre>npm publish</pre></div><blockquote class="wolai-block inline-wrap"><span>也可以登录 npm 的 web 端，对已发布的应用进行管理</span></blockquote><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>注意</strong></span></div></div><ul class="wolai-block"><li class="inline-wrap"><div class="marker"></div><span>发布到 npm 仓库上的 package，必须包含 package.json 文件，且内容格式必须满足特定要求：</span><span><a href="https://docs.npmjs.com/cli/v7/configuring-npm/package-json"><span>https://docs.npmjs.com/cli/v7/configuring-npm/package-json</span></a></span></li><li class="inline-wrap"><div class="marker"></div><span>package 的名字除了满足格式要求外，要发布到 npm 仓库中的 package 名称不能重复，可以使用 scope 来进行命名</span></li></ul><h3 class="wolai-block inline-wrap"><span>2-2、更新</span></h3><div class="wolai-block wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre>npm update</pre></div><h3 class="wolai-block inline-wrap"><span>2-3、删除</span></h3><div class="wolai-block wolai-pre"><div data-lang="PowerShell" class="marker"></div><pre>npm unpublish</pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div><h2 class="wolai-block inline-wrap"><span>发布生成二进制可执行 package</span></h2><div class="wolai-block wolai-text"><div class="inline-wrap"><span>我们可以通过一些配合和操作把当前的 package 发布生成成为 二进制可执行的 程序。</span></div></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span><strong>package.json 中的 bin 字段</strong></span></div></div><div class="wolai-block wolai-pre"><div data-lang="Json" class="marker"></div><pre><span class="token punctuation">{</span>
  <span class="token property">"bin"</span><span class="token operator">:</span> <span class="token string">"./xxx.js"</span>
<span class="token punctuation">}</span></pre></div><div class="wolai-block wolai-text"><div class="inline-wrap"><span>在是使用 npm install 安装该 package 的时候，会自动生成 bin 文件（链接到 </span><span><code>bin</code></span><span> 字段指定的文件）</span></div></div><blockquote class="wolai-block inline-wrap"><span>执行为执行脚本的文件需要加入：</span><span><code>#!/usr/bin/env node</code></span><span> 来执行执行该脚本的环境和应用</span></blockquote><div class="wolai-block wolai-text"><div class="inline-wrap"><span></span><br/></div></div></article><footer></footer></body></html>